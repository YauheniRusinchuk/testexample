import{b as Q,i as W,l as P,d as X,c as v,ac as Z,H as g,f as ee,g as ae,r as se,h as l,a as te,w as A,I as ne,z as p,J as $,T as oe,u as n,s as B,L as ie,m as s,t as d,q as ce,j as m,p as re,e as le,M as de,P as N,N as ue,o as i,n as S,S as M}from"./gpb-new.3d7b750a.js";import{u as pe,_ as _e,a as ve,b as me,D as fe,U as he,V as be,c as ye,d as ge,M as Se,J as Te}from"./FormHeader.77c79ab5.js";import{_ as Ce}from"./angle-right_blue.3c01ebe8.js";import{D as De,a as ke}from"./Dialog.b08ee629.js";import{u as Ie}from"./usePaymentAvailability.6a2045fa.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./useLoader.7f9e5dbf.js";const we=s("div",{id:"acs"},null,-1),Ee={key:0,class:"content-wrapper offer"},Ve={key:0,class:"main-form__title-Saved-Card"},Pe={class:"pan-input-container"},Ae={class:"input pan-offer"},$e={class:"input__group"},Be={for:"pan"},Ne=s("input",{id:"pan",name:"pan",type:"password",disabled:"true",value:""},null,-1),Me={class:"pan-value"},Ue={class:"icons-container"},He={class:"card-brand"},Fe=["src"],Oe=s("div",{class:"cvc-logo"},[s("img",{src:me,alt:"CVC"})],-1),Re={key:1,class:"checkbox-container"},Le={class:"pay-btn-container"},qe=["disabled"],ze={key:1,class:"content-wrapper offer"},je={class:"treeDS-info"},Je={class:"treeDS-info__title"},Ye={class:"treeDS-info__description"},xe={class:"content-wrapper"},Ge={class:"back-to-merchant-container"},Ke=s("img",{class:"angle-right",src:Ce},null,-1),na={setup(Qe){const{checkPaymentState:T,paymentState:a,timeoutApiErrorHandlerCb:U}=Q(),{state:H,accept:F,decline:O}=re(),u=W(),{card:o}=pe(),f=P(!1),{iframeHandler:R,apiErrorHandlerOn:L,apiErrorHandlerOff:q}=X(),{requestProcessing:C,globalLoaderShow:z,globalLoaderHide:D}=le(),h=P(!1),j=v(()=>`\u2022 \u2022 \u2022 \u2022  ${(a.value.dst?a.value.dst.pan:a.value.src.pan).substr(-4)}`),J=v(()=>{const e=a.value.dst?a.value.dst.pan:a.value.src.pan;return de(e,{UPI:he,VISA:be,MASTERCARD:ye,MAESTRO:ge,MIR:Se,JCB:Te},fe)}),k=v(()=>a.value.paymentId===N.OCT?"transferToCard":a.value.paymentId===N.AFT?"transferToAccount":"pay"),Y=v(()=>!o.cvc||o.cvc.length<=ue.CVC);function b(){var t,c;let e=!1;return((t=a.value.options)==null?void 0:t.srcChangeDisabled)&&a.value.src.type!==M.gazprom_pay||u.query.paymentId&&u.query.paymentId==="oct"?e=!1:e=!((c=a.value.options)!=null&&c.srcCscDisabled),e}function x(){var e,t;return((e=a.value.src)==null?void 0:e.type)===M.gazprom_pay&&((t=a.value.src)==null?void 0:t.addToProfileEnabled)}async function G(){var _,r;C(),z(),h.value=!0;const e=u.hash.slice(1),t={};b()&&(t["src.csc"]=o.cvc),o.save&&(t["src.addToProfile"]=!0),(r=(_=a.value)==null?void 0:_.options)!=null&&r.customerReceiptAreaEnabled&&Object.assign(t,{"customer.receiptUrl":location.origin+"/"+window.location.hash});const c=await F(e,t);await T(c,e),c.state===g.RESULT&&D()}async function K(){C();const e=u.hash.slice(1);try{await O(e)}catch(t){console.log(t)}finally{location.href=u.query.back_url_f}}return Z(()=>{if(a.value.state===g["3DS2INFO"]){h.value=!1,D();const e=u.hash.slice(1);setTimeout(async()=>{const t=await H(e);await T(t,e)},3e4)}}),ee(async()=>{R(f),L(U),await Ie(a)}),ae(()=>q()),(e,t)=>{const c=se("focus-next");return i(),l(B,null,[(i(),te(oe,{to:"body"},[A(p(De,null,{default:$(()=>[we]),_:1},512),[[ne,f.value]])])),n(a)&&!h.value&&!f.value?(i(),l(B,{key:0},[n(a).state!==n(g)["3DS2INFO"]?(i(),l("div",Ee,[p(_e,{data:n(a)},null,8,["data"]),p(n(ie),{class:"main-form",onSubmit:G},{default:$(({isSubmitting:_,errors:r})=>{var I,w,E,V;return[((w=(I=n(a))==null?void 0:I.src)==null?void 0:w.cardId)||((V=(E=n(a))==null?void 0:E.dst)==null?void 0:V.cardId)?(i(),l("div",Ve,d(e.$t(`pages.offer.titleSavedCard.${n(k)}`)),1)):m("",!0),s("div",{class:S(["pan-cvc-input-container",{invalid:r.cvc}])},[s("div",Pe,[s("div",Ae,[s("div",$e,[s("label",Be,d(e.$t("ui.input.pan.label")),1),Ne,s("span",Me,d(n(j)),1)])]),s("div",Ue,[s("div",He,[s("img",{src:n(J),alt:"Brand"},null,8,Fe)])])]),b()?(i(),l("div",{key:0,class:S(["cvc-input-group",{invalid:r.cvc}])},[A(p(ve,{modelValue:n(o).cvc,"onUpdate:modelValue":t[0]||(t[0]=y=>n(o).cvc=y),errors:r,class:S({"none-empty-input":n(o).cvc})},null,8,["modelValue","errors","class"]),[[c,{length:3,target:"addToProfile"}]]),Oe],2)):m("",!0)],2),x()?(i(),l("div",Re,[p(ke,{modelValue:n(o).save,"onUpdate:modelValue":t[1]||(t[1]=y=>n(o).save=y),name:"addToProfile",class:"addToProfile",label:e.$t("ui.input.saveCard.label")},null,8,["modelValue","label"])])):m("",!0),s("div",Le,[s("button",{id:"submitBtn",type:"submit",disabled:_||Object.keys(r).length||b()&&n(Y),class:"btn btn-primary"},d(e.$t(`ui.btn.${n(k)}`)),9,qe)])]}),_:1})])):(i(),l("div",ze,[s("div",je,[s("div",Je,d(e.$t("pages.offer.titleTreeDSInfo")),1),s("div",Ye,d(n(a).cardholderInfo),1)])])),s("div",xe,[s("div",Ge,[s("button",{class:"btn back-to-merchant",onClick:K},[ce(d(e.$t("ui.btn.goToMerchant"))+" ",1),Ke])])])],64)):m("",!0)],64)}}};export{na as default};
